---
import { getCollection } from 'astro:content';

const electoralPeriodsCollection = await getCollection('electoralPeriods');
const electoralPeriods = electoralPeriodsCollection
  .sort((a, b) => a.data.name.localeCompare(b.data.name))
  .map(electoralPeriodEntry => ({
  id: electoralPeriodEntry.data.id,
  title: electoralPeriodEntry.data.name
}));

const { electoralPeriod } = Astro.props;

const pathname = Astro.url.pathname.toLowerCase();
let activePage = '';
switch (true) {
  case pathname.startsWith(`/ep/${electoralPeriod.id}/session/`) || pathname === `/ep/${electoralPeriod.id}/sessions`:
    activePage = 'sessions';
    break;
  case pathname.startsWith(`/ep/${electoralPeriod.id}/faction/`) || pathname === `/ep/${electoralPeriod.id}/factions`:
    activePage = 'factions';
    break;
  case pathname.startsWith(`/ep/${electoralPeriod.id}/party/`) || pathname === `/ep/${electoralPeriod.id}/parties`:
    activePage = 'parties';
    break;
  case pathname.startsWith(`/ep/${electoralPeriod.id}/person/`) || pathname === `/ep/${electoralPeriod.id}/persons`:
    activePage = 'persons';
    break;
}

---

<nav class="bg-gray-800" x-data="{ menuOpen: false }">

  <div class="mx-auto max-w-7xl px-6 lg:px-8">
    <div class="flex h-16 items-center justify-between">
      <div class="flex items-center">
        <div class="shrink-0">
          <a href="/" class="text-gray-300 font-bold text-2xl">StadtratWatch</a>
        </div>
        <div class="hidden md:ml-6 md:flex">
          <div class="flex space-x-2">
            <div class="shrink-0 grid grid-cols-1">
              <select
                name="election-period"
                aria-label="Wahlperiode"
                @change="window.location.href = `/ep/${$event.target.value}`"
                class="col-start-1 row-start-1 w-full appearance-none rounded-md bg-white py-1.5 pl-3 pr-8 text-sm/6 text-gray-900 outline outline-1 -outline-offset-1 outline-gray-300 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600"
              >
                {
                  electoralPeriods.map(electoralPeriodOption =>
                    <option
                      value={electoralPeriodOption.id}
                      selected={electoralPeriodOption.id === electoralPeriod.id}
                    >{electoralPeriodOption.title}</option>
                  )
                }
              </select>
              <svg class="pointer-events-none col-start-1 row-start-1 mr-2 size-4 self-center justify-self-end text-gray-500" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true" data-slot="icon">
                <path fill-rule="evenodd" d="M4.22 6.22a.75.75 0 0 1 1.06 0L8 8.94l2.72-2.72a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
              </svg>
            </div>
            <a
              href={`/ep/${electoralPeriod.id}/sessions`}
              class="rounded-md px-3 py-2 text-sm font-medium"
              class:list={
                [
                  { 'text-white bg-gray-900': activePage === 'sessions' },
                  { 'text-gray-300 hover:bg-gray-700 hover:text-white': activePage !== 'sessions' }
                ]
              }
            >Sitzungen</a>
            <a
              href={`/ep/${electoralPeriod.id}/factions`}
              class="rounded-md px-3 py-2 text-sm font-medium"
              class:list={
                [
                  { 'text-white bg-gray-900': activePage === 'factions' },
                  { 'text-gray-300 hover:bg-gray-700 hover:text-white': activePage !== 'factions' }
                ]
              }
            >Fraktionen</a>
            <a
              href={`/ep/${electoralPeriod.id}/parties`}
              class="rounded-md px-3 py-2 text-sm font-medium"
              class:list={
                [
                  { 'text-white bg-gray-900': activePage === 'parties' },
                  { 'text-gray-300 hover:bg-gray-700 hover:text-white': activePage !== 'parties' }
                ]
              }
            >Parteien</a>
            <a
              href={`/ep/${electoralPeriod.id}/persons`}
              class="rounded-md px-3 py-2 text-sm font-medium"
              class:list={
                [
                  { 'text-white bg-gray-900': activePage === 'persons' },
                  { 'text-gray-300 hover:bg-gray-700 hover:text-white': activePage !== 'persons' }
                ]
              }
            >Personen</a>
          </div>
        </div>
      </div>
      <div class="hidden md:ml-6 md:flex">
        <form
          class="grid grid-cols-1"
          @submit.prevent="$event.target.search.value.trim() !== '' ? window.location.href = `/search?q=${$event.target.search.value}` : null"
        >
          <input
            type="search"
            name="search"
            aria-label="Suche"
            class="col-start-1 row-start-1 block w-full rounded-md bg-white py-1.5 pl-10 pr-3 text-sm/6 text-gray-900 outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600"
            placeholder="Suche">
          <svg class="pointer-events-none col-start-1 row-start-1 ml-3 size-4 self-center text-gray-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon">
            <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 1 0 0 11 5.5 5.5 0 0 0 0-11ZM2 9a7 7 0 1 1 12.452 4.391l3.328 3.329a.75.75 0 1 1-1.06 1.06l-3.329-3.328A7 7 0 0 1 2 9Z" clip-rule="evenodd" />
          </svg>
        </form>
      </div>
      <div class="-mr-2 flex md:hidden">
        <button
          type="button"
          class="relative inline-flex items-center justify-center rounded-md p-2 text-gray-400 hover:bg-gray-700 hover:text-white focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white"
          aria-controls="mobile-menu"
          :aria-expanded="menuOpen"
          @click="menuOpen = !menuOpen"
        >
          <span class="absolute -inset-0.5"></span>
          <span class="sr-only">Hauptmenü öffnen</span>
          <svg
            class="block size-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            :aria-hidden="!menuOpen"
            data-slot="icon"
            x-cloak
            x-show="!menuOpen"
          >
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
          </svg>
          <svg
            class="size-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            :aria-hidden="menuOpen"
            data-slot="icon"
            x-cloak
            x-show="menuOpen"          >
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <div class="md:hidden" id="mobile-menu" x-show="menuOpen">

    <div class="flex px-5">
      <div class="grid grid-cols-1">
        <select
          name="election-period"
          aria-label="Wahlperiode"
          @change="window.location.href = `/ep/${$event.target.value}`"
          class="col-start-1 row-start-1 w-full appearance-none rounded-md bg-white py-1.5 pl-3 pr-8 text-base text-gray-900 outline outline-1 -outline-offset-1 outline-gray-300 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600"
        >
          {
            electoralPeriods.map(electoralPeriodOption =>
              <option
                value={electoralPeriodOption.id}
                selected={electoralPeriodOption.id === electoralPeriod.id}
              >{electoralPeriodOption.title}</option>
            )
          }
        </select>
        <svg class="pointer-events-none col-start-1 row-start-1 mr-2 size-5 self-center justify-self-end text-gray-500" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true" data-slot="icon">
          <path fill-rule="evenodd" d="M4.22 6.22a.75.75 0 0 1 1.06 0L8 8.94l2.72-2.72a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
        </svg>
      </div>
    </div>

    <div class="space-y-1 px-2 pb-3 pt-2">
      <a
        href={`/ep/${electoralPeriod.id}/sessions`}
        class="block rounded-md px-3 py-2 text-base font-medium"
        class:list={
          [
            { 'text-white bg-gray-900': activePage === 'sessions' },
            { 'text-gray-300 hover:bg-gray-700 hover:text-white': activePage !== 'sessions' }
          ]
        }
      >Sitzungen</a>
      <a
        href={`/ep/${electoralPeriod.id}/factions`}
        class="block rounded-md px-3 py-2 text-base font-medium"
        class:list={
          [
            { 'text-white bg-gray-900': activePage === 'factions' },
            { 'text-gray-300 hover:bg-gray-700 hover:text-white': activePage !== 'factions' }
          ]
        }
      >Fraktionen</a>
      <a
        href={`/ep/${electoralPeriod.id}/parties`}
        class="block rounded-md px-3 py-2 text-base font-medium"
        class:list={
          [
            { 'text-white bg-gray-900': activePage === 'parties' },
            { 'text-gray-300 hover:bg-gray-700 hover:text-white': activePage !== 'parties' }
          ]
        }
      >Parteien</a>
      <a
        href={`/ep/${electoralPeriod.id}/persons`}
        class="block rounded-md px-3 py-2 text-base font-medium"
        class:list={
          [
            { 'text-white bg-gray-900': activePage === 'persons' },
            { 'text-gray-300 hover:bg-gray-700 hover:text-white': activePage !== 'persons' }
          ]
        }
      >Personen</a>
    </div>

    <div class="border-t border-gray-700 pb-3 pt-4">
      <div class="flex px-5">
        <form
          class="grid grid-cols-1"
          @submit.prevent="$event.target.search.value.trim() !== '' ? window.location.href = `/search?q=${$event.target.search.value}` : null"
        >
          <input
            type="search"
            name="search"
            aria-label="Suche"
            class="col-start-1 row-start-1 block w-full rounded-md bg-white py-1.5 pl-10 pr-3 text-base text-gray-900 outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600"
            placeholder="Suche">
          <svg class="pointer-events-none col-start-1 row-start-1 ml-3 size-5 self-center text-gray-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon">
            <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 1 0 0 11 5.5 5.5 0 0 0 0-11ZM2 9a7 7 0 1 1 12.452 4.391l3.328 3.329a.75.75 0 1 1-1.06 1.06l-3.329-3.328A7 7 0 0 1 2 9Z" clip-rule="evenodd" />
          </svg>
        </form>
      </div>
    </div>

  </div>

</nav>
